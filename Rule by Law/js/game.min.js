var t,e,n,a,i,o,c,r,s,d,l,u,f,m,x,h,p,v,y,g,C,R=function(t,e){return t--,0>t?t=0:e(),t},k=function(t,e){100*Math.random()<=t&&e()},q=function(t,e){var n,a,i,d=e?g.crimeAgainRate:g.crimeRate;for(n=0;t>n;n++)a=0,i=!1,k(d,function(){var t=100*Math.random();C.reduce(function(n,r){var d=n.rate+r.rate;return t>=n.rate&&d>t&&(0===r.day?(a=0,i=!0,e?c=R(c,function(){s++}):o=R(o,function(){s++})):a=r.day),{rate:d}},{rate:0})}),a&&(e?c=R(c,function(){r++}):o=R(o,function(){r++}),y.push(setTimeout(function(){r=R(r,function(){c++})},1e3/g.speed*a)))},w=function(t,e){var n,a=0;for(n=0;t>n;n++)k(e,function(){a++});return a},b=function(t,e,n,a){e>t?n.text("+"+(e-t)).removeClass("plus").animate({},0,function(){n.addClass("plus")}):t>e&&a.text(e-t).removeClass("minus").animate({},0,function(){a.addClass("minus")})},z=function(i){p||(clearInterval(e),i&&(1e4>=a-n&&(n=(new Date).getTime()),e=setInterval(t,1e3/g.speed)))},M=function(){i=0,o=1e4,c=0,r=0,s=0,d=0,l=0,u=0,f=0,m=0,x=2,h=!1,p=!0,v=.1,y=[],g={speed:10,crimeRate:.1,crimeAgainRate:.5,newRate:.1,deadRate:.1,cost:0},C=[{name:"盗窃",rate:25,day:10},{name:"嫖娼",rate:25,day:10},{name:"抢劫",rate:12,day:30},{name:"行贿",rate:12,day:30},{name:"贪污",rate:8,day:100},{name:"伤人",rate:8,day:150},{name:"卖淫",rate:4,day:500},{name:"强奸",rate:3,day:700},{name:"贩毒",rate:2,day:1e3},{name:"杀人",rate:1,day:0}]};$(function(){var C,R,T,I,A,D=$("header h2 div"),j=D.eq(0),B=D.eq(1),E=j.children("span"),O=j.find("p span"),L=$("header nav > span"),V=L.eq(0).children(),Z=L.eq(1),F=L.eq(2),G=$("section figure"),H=G.eq(0).children("span:first"),J=H.next(),K=J.next(),N=G.eq(1).children("span:first"),P=N.next(),Q=P.next(),S=G.eq(2).children("span:first"),U=S.next(),W=U.next(),X=G.eq(3).children("span:first"),Y=X.next(),_=Y.next(),tt=$("footer p:first"),et=$("#setting"),nt=et.children(),at=nt.find("#cost"),it=nt.find(":input"),ot=function(t){var e=$(".ZLDialog:first form:first").serializeObject();return m<e.cost?void $.dialog.message({content:"金钱不足！",lock:!0}):(m-=e.cost,e.cost>0?e.cost=Math.ceil(1.2*e.cost):e.cost=1,$.extend(g,e),"function"===$.type(t)&&t(),void A())},ct={title:"依法治国-设置",size:{width:350},buttons:[{text:"确定",callback:ot},{text:"取消"}],closeBack:function(){z(!0)}},rt=$.extend({},ct,{buttons:ct.buttons.concat([{text:"抗击瘟疫！",callback:function(){ot(function(){h=!1,tt.text("")})}}])}),st={title:"依法治国-帮助",size:{width:300},content:"<h3>游戏玩法</h3><p>　　游戏起始人口为10000人，游戏总天数为2000天，你需要使用随机产生的金钱来修改游戏参数，使人口数量维持在10000左右，在游戏结束时，人口数量误差在5%以内算胜利！</p><p>　　游戏中有一定概率遭遇“瘟疫横行”，建议预留研制药物所需资金！</p><h3>关于游戏</h3><p>版本：V1.0.4 Alpha</p><p>作者：智能小菜菜</p><p>邮箱：<a href='mailto:zl2012xyz@hotmail.com'>zl2012xyz@hotmail.com</a></p>",closeBack:function(){z(!0)}},dt=function(){M(),B.removeClass("hidden"),j.addClass("hidden")};t=function(){var t,p;if(a=(new Date).getTime(),a-n>3e3)return z(),tt.text("程序过于卡顿，游戏结束！"),void dt();for(a-n>1e3/g.speed*2&&(g.speed/=2,z(!0),clearTimeout(tt.timeout),tt.addClass("slow"),tt.timeout=setTimeout(function(){tt.removeClass("slow")},1e3)),n=a,C=0;3>C;C++)k(x,function(){m++});V.text(m),q(o),q(c,!0),h?(t=.1*g.newRate,p=10*g.deadRate):(t=g.newRate,p=g.deadRate),o+=w(o+c+r,t),R=Math.min(w(o,p),o),o-=R,T=Math.min(w(c,p),c),c-=T,I=Math.min(w(r,p),r),y.splice(r.length-I,I).forEach(function(t){clearTimeout(t)}),r-=I,s+=R+T+I,E.text(++i),O.text(o+c+r),H.text(o),N.text(c),S.text(r),X.text(s),b(d,o,J,K),b(l,c,P,Q),b(u,r,U,W),b(f,s,Y,_),h||k(v,function(){h=!0,tt.text("瘟疫正在横行！")}),o+c+r===0&&(clearInterval(e),tt.text("人类在第"+i+"天灭亡，游戏结束！"),dt()),2e3===i&&(clearInterval(e),Math.abs(o+c+r-1e4)<500?(tt.text("你获得了胜利！"),dt()):(tt.text("你失败了！"),dt())),d=o,l=c,u=r,f=s},B.on("click",function(){p=!1,j.removeClass("hidden"),B.addClass("hidden"),E.text(i),O.text(o+c+r),H.text(o),N.text(c),S.text(r),X.text(s),tt.text(""),z(!0)}),F.on("click",function(){z(),$.dialog(st)}),Z.on("click",function(){p||(z(),Object.keys(g).forEach(function(t){it.filter("[name="+t+"]").val(g[t]).attr("value",g[t])}),at.text(g.cost),A=et.dialog(h?rt:ct))}),M()});