var t,e,n,a,i,o,c,r,s,d,u,f,l,m,x,h,p,v,y,g,C,R=function(t,e){return t--,0>t?t=0:e(),t},k=function(t,e){100*Math.random()<=t&&e()},q=function(t,e){var n,a,i,d=e?g.crimeAgainRate:g.crimeRate;for(n=0;t>n;n++)a=0,i=!1,k(d,function(){var t=100*Math.random();C.reduce(function(n,r){var d=n.rate+r.rate;return t>=n.rate&&d>t&&(0===r.day?(a=0,i=!0,e?c=R(c,function(){s++}):o=R(o,function(){s++})):a=r.day),{rate:d}},{rate:0})}),a&&(e?c=R(c,function(){r++}):o=R(o,function(){r++}),y.push(setTimeout(function(){r=R(r,function(){c++})},1e3/g.speed*a)))},w=function(t,e){var n,a=0;for(n=0;t>n;n++)k(e,function(){a++});return a},b=function(t,e,n,a){e>t?n.text("+"+(e-t)).removeClass("plus").animate({},0,function(){n.addClass("plus")}):t>e&&a.text(e-t).removeClass("minus").animate({},0,function(){a.addClass("minus")})},z=function(a){p||(clearInterval(e),a&&(n=(new Date).getTime(),e=setInterval(t,1e3/g.speed)))},M=function(){i=0,o=1e4,c=0,r=0,s=0,d=0,u=0,f=0,l=0,m=0,x=2,h=!1,p=!0,v=.1,y=[],g={speed:10,crimeRate:.1,crimeAgainRate:.5,newRate:.1,deadRate:.1,cost:0},C=[{name:"盗窃",rate:25,day:10},{name:"嫖娼",rate:25,day:10},{name:"抢劫",rate:12,day:30},{name:"行贿",rate:12,day:30},{name:"贪污",rate:8,day:100},{name:"伤人",rate:8,day:150},{name:"卖淫",rate:4,day:500},{name:"强奸",rate:3,day:700},{name:"贩毒",rate:2,day:1e3},{name:"杀人",rate:1,day:0}]};$(function(){var e,C,R,T,A,D=$("header h2 div"),j=D.eq(0),B=D.eq(1),E=j.children("span"),I=j.find("p span"),O=$("header nav > span"),L=O.eq(0).children(),V=O.eq(1),Z=O.eq(2),F=$("section figure"),G=F.eq(0).children("span:first"),H=G.next(),J=H.next(),K=F.eq(1).children("span:first"),N=K.next(),P=N.next(),Q=F.eq(2).children("span:first"),S=Q.next(),U=S.next(),W=F.eq(3).children("span:first"),X=W.next(),Y=X.next(),_=$("footer p:first"),tt=$("#setting"),et=tt.children(),nt=et.find("#cost"),at=et.find(":input"),it=function(t,e){return m<g.cost?void $.dialog.message({content:"金钱不足！",lock:!0}):(m-=g.cost,g.cost>0?g.cost=Math.ceil(1.2*g.cost):g.cost=1,e||$.extend(g,$(".ZLDialog:first form:first").serializeObject()),"function"===$.type(t)&&t(),void A())},ot={title:"依法治国-设置",size:{width:350},buttons:[{text:"确定",callback:it},{text:"取消"}],closeBack:function(){z(!0)}},ct=$.extend({},ot,{buttons:ot.buttons.concat([{text:"抗击瘟疫！",callback:function(){it(function(){h=!1,_.text("")},!0)}}])}),rt={title:"依法治国-帮助",size:{width:300},content:"<h3>游戏玩法</h3><p>　　游戏起始人口为10000人，游戏总天数为2000天，你需要使用随机产生的金钱来修改游戏参数，使人口数量维持在10000左右，在游戏结束时，人口数量误差在5%以内算胜利！</p><p>　　游戏中有一定概率遭遇“瘟疫横行”，建议预留研制药物所需资金！</p><h3>关于游戏</h3><p>版本：V1.0.8 Alpha</p><p>作者：智能小菜菜</p><p>邮箱：<a href='mailto:zl2012xyz@hotmail.com'>zl2012xyz@hotmail.com</a></p>",closeBack:function(){z(!0)}},st=function(){z(),M(),B.removeClass("hidden"),j.addClass("hidden")};t=function(){var t,p;if(a=(new Date).getTime(),a-n>3e3||g.speed<1)return _.text("程序过于卡顿，游戏结束！"),void st();for(a-n>1e3/g.speed*2&&(g.speed-=4.95,z(!0),clearTimeout(_.timeout),_.addClass("slow"),_.timeout=setTimeout(function(){_.removeClass("slow")},1e3)),n=a,e=0;3>e;e++)k(x,function(){m++});L.text(m),q(o),q(c,!0),h?(t=.1*g.newRate,p=10*g.deadRate):(t=g.newRate,p=g.deadRate),o+=w(o+c+r,t),C=Math.min(w(o,p),o),o-=C,R=Math.min(w(c,p),c),c-=R,T=Math.min(w(r,p),r),y.splice(r.length-T,T).forEach(function(t){clearTimeout(t)}),r-=T,s+=C+R+T,E.text(++i),I.text(o+c+r),G.text(o),K.text(c),Q.text(r),W.text(s),b(d,o,H,J),b(u,c,N,P),b(f,r,S,U),b(l,s,X,Y),h||k(v,function(){h=!0,_.text("瘟疫正在横行！")}),o+c+r===0&&(_.text("人类在第"+i+"天灭亡，游戏结束！"),st()),2e3===i&&(Math.abs(o+c+r-1e4)<500?(_.text("你获得了胜利！"),st()):(_.text("你失败了！"),st())),d=o,u=c,f=r,l=s},B.on("click",function(){p=!1,j.removeClass("hidden"),B.addClass("hidden"),E.text(i),I.text(o+c+r),G.text(o),K.text(c),Q.text(r),W.text(s),_.text(""),z(!0)}),Z.on("click",function(){z(),$.dialog(rt)}),V.on("click",function(){p||(z(),Object.keys(g).forEach(function(t){at.filter("[name="+t+"]").val(g[t]).attr("value",g[t])}),nt.text(g.cost),A=tt.dialog(h?ct:ot))}),M()});